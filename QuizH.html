<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            function initDatabase() {
                return new Promise((resolve, reject) => {
                    let request = indexedDB.open('UserDatabase', 1);

                    request.onupgradeneeded = (event) => {
                        let db = event.target.result;
                        if (!db.objectStoreNames.contains('users')) {
                            let objectStore = db.createObjectStore('users', { keyPath: 'id', autoIncrement: true });
                            objectStore.createIndex('nome', 'nome', { unique: false });
                            objectStore.createIndex('cognome', 'cognome', { unique: false });
                        }
                    };

                    request.onsuccess = (event) => {
                        resolve(event.target.result);
                    };

                    request.onerror = (event) => {
                        reject(event.target.error);
                    };
                });
            }

            function updateUserScore(db, userId, score) {
                return new Promise((resolve, reject) => {
                    let transaction = db.transaction(['users'], 'readwrite');
                    let store = transaction.objectStore('users');
                    let request = store.get(userId);

                    request.onsuccess = (event) => {
                        let user = event.target.result;
                        user.punteggio += score;
                        let updateRequest = store.put(user);
                        updateRequest.onsuccess = () => {
                            resolve();
                        };
                        updateRequest.onerror = (event) => {
                            reject(event.target.error);
                        };
                    };

                    request.onerror = (event) => {
                        reject(event.target.error);
                    };
                });
            }

            document.getElementById('submitAnswer').addEventListener('click', async (event) => {
                event.preventDefault();
                let selectedAnswer = document.querySelector('input[name="answer"]:checked').value;
                let correctAnswer = 'B'; // La risposta corretta

                let userId = localStorage.getItem('userId');
                if (!userId) {
                    alert('Utente non trovato!');
                    return;
                }

                let db = await initDatabase();
                if (selectedAnswer === correctAnswer) {
                    await updateUserScore(db, userId, 1);
                    alert('Risposta corretta! Punteggio aggiornato.');
                } else {
                    alert('Risposta errata. Riprova.');
                }
            });
        });
    </script>
</head>
<body>
    <h1>Quiz a Risposta Multipla</h1>
    <form id="quizForm">
        <p>Qual Ã¨ la capitale della Francia?</p>
        <input type="radio" id="answerA" name="answer" value="A">
        <label for="answerA">A) Madrid</label><br>
        <input type="radio" id="answerB" name="answer" value="B">
        <label for="answerB">B) Parigi</label><br>
        <input type="radio" id="answerC" name="answer" value="C">
        <label for="answerC">C) Roma</label><br>
        <input type="radio" id="answerD" name="answer" value="D">
        <label for="answerD">D) Berlino</label><br><br>
        <button id="submitAnswer">Invia Risposta</button>
    </form>
</body>
</html>
