<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salva su IndexedDB</title>
</head>
<body>
    <h1>Salva Nome e Cognome</h1>
    <form id="myForm">
        <label for="firstName">Nome:</label>
        <input type="text" id="firstName" required>
        <br>
        <label for="lastName">Cognome:</label>
        <input type="text" id="lastName" required>
        <br>        
        <button type="button" onclick="salvaDati()">Salva</button>
    </form>

    <script>
        // Apri il database
        const request = window.indexedDB.open("MyTestDatabase", 3);

        request.onupgradeneeded = function(event) {
            const db = event.target.result;
            const store = db.createObjectStore("utenti", { keyPath: "ID", autoIncrement: true });
                                                   };

        function salvaDati()
        {
            const db = request.result;
            const transaction = db.transaction(["utenti"], "readwrite");
            const store = transaction.objectStore("utenti");

            const nome = document.getElementById("firstName").value;
            const cognome = document.getElementById("lastName").value;

            const request = store.openCursor();
                request.onsuccess = function(event) 
                {
                const cursor = event.target.result;
                    
                if (cursor) {
                    const existingCognome = cursor.value.Cognome;
                        if (existingCognome === cognome) 
                        {
                        // Il cognome è già presente, mostra un messaggio di errore
                        alert("Hai già fatto il test!");
                        return;
                        }
                    else 
                        {
                          const quizLink = "https://potasovvi.github.io/Trivial-Pursuit-HP/index2.html"; // Inserisci il link del quiz esterno

                     // Reindirizzamento
                    window.location.href = quizLink + "?nome=" + nome + "&cognome=" + cognome;
            
                    const utente = { Nome: nome, Cognome: cognome };
                    store.add(utente);

                                                transaction.oncomplete = function() 
                                                {
                                                    console.log("Dati salvati con successo su IndexedDB!");

                                                     // Cancella il contenuto nei campi del form
                                                    document.getElementById("firstName").value = "";
                                                    document.getElementById("lastName").value = "";
                                                  }   
                            }
                    cursor.continue();
                    }           
               };
            }
    </script>
</body>
</html>
