<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizza Utenti</title>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            // Funzione per inizializzare il database IndexedDB
            function initDatabase() {
                return new Promise((resolve, reject) => {
                    let request = indexedDB.open('UserDatabase', 1);

                    request.onupgradeneeded = (event) => {
                        let db = event.target.result;
                        if (!db.objectStoreNames.contains('users')) {
                            let objectStore = db.createObjectStore('users', { keyPath: 'id', autoIncrement: true });
                            objectStore.createIndex('nome', 'nome', { unique: false });
                            objectStore.createIndex('cognome', 'cognome', { unique: false });
                        }
                    };

                    request.onsuccess = (event) => {
                        resolve(event.target.result);
                    };

                    request.onerror = (event) => {
                        reject(event.target.error);
                    };
                });
            }

            // Funzione per recuperare e mostrare tutti gli utenti nel database
            function getAllUsers(db) {
                return new Promise((resolve, reject) => {
                    let transaction = db.transaction(['users'], 'readonly');
                    let store = transaction.objectStore('users');
                    let request = store.getAll();

                    request.onsuccess = (event) => {
                        resolve(event.target.result);
                    };

                    request.onerror = (event) => {
                        reject(event.target.error);
                    };
                });
            }

            // Evento click per il pulsante Mostra Utenti
            document.getElementById('showUsersButton').addEventListener('click', async (event) => {
                event.preventDefault();

                let db = await initDatabase();
                let users = await getAllUsers(db);

                let table = document.getElementById('usersTable');
                table.innerHTML = '<tr><th>ID</th><th>Nome</th><th>Cognome</th><th>Punteggio</th></tr>';
                
                users.forEach(user => {
                    let row = table.insertRow();
                    row.insertCell(0).innerText = user.id;
                    row.insertCell(1).innerText = user.nome;
                    row.insertCell(2).innerText = user.cognome;
                    row.insertCell(3).innerText = user.punteggio;
                });
            });

            // Inizializzare il database e caricare i dati all'avvio della pagina
            (async () => {
                let db = await initDatabase();
                let users = await getAllUsers(db);

                let table = document.getElementById('usersTable');
                table.innerHTML = '<tr><th>ID</th><th>Nome</th><th>Cognome</th><th>Punteggio</th></tr>';
                
                users.forEach(user => {
                    let row = table.insertRow();
                    row.insertCell(0).innerText = user.id;
                    row.insertCell(1).innerText = user.nome;
                    row.insertCell(2).innerText = user.cognome;
                    row.insertCell(3).innerText = user.punteggio;
                });
            })();
        });
    </script>
</head>
<body>
    <h1>Visualizza Utenti Registrati</h1>
    <button id="showUsersButton">Mostra Utenti</button>
    <table id="usersTable" border="1">
        <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Cognome</th>
            <th>Punteggio</th>
        </tr>
    </table>
</body>
</html>
